# Reel Translation Setup

Эта функция переводит Instagram Reels между английским и русским языками, перезаписывая аудиодорожку новым озвучиванием.

## Быстрый старт

1. Убедитесь, что `ffmpeg` установлен и доступен (`FFMPEG_PATH` можно указать явно).
2. Добавьте новые переменные окружения в `video-bot/.env` или платформе деплоя:
   ```env
   ENABLE_REEL_TRANSLATION=1
   OPENAI_API_KEY=<выданный ключ>
   OPENAI_WHISPER_MODEL=gpt-4o-mini-transcribe    # опционально
   OPENAI_TRANSLATE_MODEL=gpt-4o-mini             # опционально
   HUME_API_KEY=<API ключ Hume>
   HUME_CLIENT_SECRET=<Secret key Hume>
   HUME_VOICE_ID=octave-2-evi                     # опционально, можно менять
   HUME_AUDIO_FORMAT=wav                          # поддерживаются wav/mp3/flac
   ```
3. Перезапустите бота.
4. В Telegram используйте `/translate <ссылка на рилс> [en-ru|ru-en|auto]`.

## Как это работает

1. Бот скачивает рилс через текущий провайдер Instagram.
2. `ffmpeg` извлекает аудио дорожку (mono 16 кГц).
3. Whisper (OpenAI) расшифровывает речь и пытается определить язык.
4. ChatGPT переводит текст на нужный язык.
5. Hume Octave 2 синтезирует озвучку выбранным голосом.
6. `ffmpeg` собирает итоговый ролик с новой аудиодорожкой.

## Отладка

- Логи этапов выводятся при уровне `info` (см. `translateInstagramReel`).
- Временные файлы сохраняются в директории сессии до очистки.
- При ошибках от внешних API возвращается человеко-понятное сообщение в Telegram и подробности в логах.

## Ограничения

- Поддерживаются только ссылки на Instagram Reels.
- Whisper ожидает английский или русский; для других языков перевод не производится.
- Итоговый файл должен укладываться в текущий лимит (≈2 ГБ).
- Высокая нагрузка: не более двух одновременных переводов на пользователя (ограничение rateLimiter).

## Настройка голоса

- Идентификатор голоса можно задать через `HUME_VOICE_ID`.
- Скорость/тон задаются через API Hume. При необходимости расширьте `synthesizeSpeech` для передачи дополнительных параметров.

## Тестирование без внешних сервисов

- Перед деплоем можно временно заглушить HTTP-клиенты (см. `src/services/*`) или добавить моковые реализации.
- Юнит/интеграционные тесты можно писать в `video-bot/test/translation`, используя фиктивные ответы OpenAI/Hume.
