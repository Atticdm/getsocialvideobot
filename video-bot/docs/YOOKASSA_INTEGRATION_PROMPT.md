# –ü—Ä–æ–º–ø—Ç: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –ÆKassa

## –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –ÆKassa (https://yookassa.ru/) –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –ø–∞–∫–µ—Ç–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É Telegram Stars –∏ –∏–∑–±–µ–∂–∞–≤ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (Telegram Stars –∏–ª–∏ –ÆKassa) –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø–∞–∫–µ—Ç–∞ "10 –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∑–∞ 500 —Ä—É–±–ª–µ–π".

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π:

1. **–ú–æ–¥—É–ª—å `src/core/payments/stars.ts`**:
   - –§—É–Ω–∫—Ü–∏–∏: `getPaymentPackage()`, `handlePreCheckoutQuery()`, `handleSuccessfulPayment()`, `createPaymentButton()`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram Bot API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–≤–æ–π—Å–æ–≤ —á–µ—Ä–µ–∑ Stars
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è `pre_checkout_query` –∏ `successful_payment` –æ—Ç Telegram

2. **–ú–æ–¥—É–ª—å `src/core/payments/credits.ts`**:
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–∞–º–∏: `checkCreditsAvailable()`, `useCredit()`, `addCredits()`, `getCreditsBalance()`
   - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞

3. **–ú–æ–¥—É–ª—å `src/core/payments/types.ts`**:
   - –¢–∏–ø—ã: `PaymentPackage`, `CreditsCheckResult`, `CreditType`, `FeatureType`
   - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–µ–¥–∏—Ç–∞–º–∏

4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –¢–∞–±–ª–∏—Ü–∞ `payment_transactions` —Å –ø–æ–ª–µ–º `telegram_payment_charge_id` (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è Stars)
   - –¢–∞–±–ª–∏—Ü–∞ `user_credits` –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
   - –¢–∞–±–ª–∏—Ü–∞ `credit_usage_log` –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

5. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä** (`src/web/server.ts`):
   - Express —Å–µ—Ä–≤–µ—Ä —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ –¥–ª—è –≤–µ–±-–∑–∞–≥—Ä—É–∑–∫–∏
   - –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook'–æ–≤ –±–æ—Ç–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ü—Ä–∏–Ω—Ü–∏–ø**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏.

**–ù–æ–≤—ã–π –º–æ–¥—É–ª—å `src/core/payments/yookassa.ts`**:
- –î–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —á—Ç–æ –∏ `stars.ts` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK –ÆKassa (`@yookassa/sdk`) –∏–ª–∏ –ø—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
- –§—É–Ω–∫—Ü–∏–∏:
  - `createPaymentLink(userId, packageInfo): Promise<string>` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É
  - `handleWebhookNotification(payload): Promise<void>` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –ÆKassa
  - `verifyPaymentSignature(payload, signature): boolean` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook'–∞

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/core/payments/types.ts`**:
- –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø `PaymentProvider = 'stars' | 'yookassa'`
- –†–∞—Å—à–∏—Ä–∏—Ç—å `PaymentPackage`:
  ```typescript
  export interface PaymentPackage {
    credits: number;
    starsAmount?: number;  // –î–ª—è Stars
    rublesAmount?: number; // –î–ª—è –ÆKassa
    priceUsd: number;
    description: string;
    provider?: PaymentProvider; // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  }
  ```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `payment_transactions`** (–Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è):
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `payment_provider VARCHAR(20) DEFAULT 'stars'` ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–ª–∞—Ç–µ–∂–∞
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `yookassa_payment_id VARCHAR(255)` ‚Äî ID –ø–ª–∞—Ç–µ–∂–∞ –æ—Ç –ÆKassa
- –ò–∑–º–µ–Ω–∏—Ç—å `telegram_payment_charge_id` –Ω–∞ `payment_external_id VARCHAR(255)` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ID –≤–Ω–µ—à–Ω–µ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `yookassa_payment_id` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–í–∞–∂–Ω–æ**: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π (ALTER TABLE —Å DEFAULT –∑–Ω–∞—á–µ–Ω–∏—è–º–∏)

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–æ–±–∞–≤–∏—Ç—å –≤ `src/core/config.ts`**:
```typescript
YOOKASSA_SHOP_ID: z.string().optional().default(''),
YOOKASSA_SECRET_KEY: z.string().optional().default(''),
YOOKASSA_WEBHOOK_SECRET: z.string().optional().default(''), // –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ webhook
YOOKASSA_ENABLED: z.coerce.boolean().optional().default(false),
YOOKASSA_PACKAGE_CREDITS: z.coerce.number().int().positive().optional().default(10),
YOOKASSA_PACKAGE_PRICE_RUB: z.coerce.number().int().positive().optional().default(500), // –†—É–±–ª–∏
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
- `YOOKASSA_SHOP_ID` ‚Äî ID –º–∞–≥–∞–∑–∏–Ω–∞ –≤ –ÆKassa
- `YOOKASSA_SECRET_KEY` ‚Äî –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è API
- `YOOKASSA_WEBHOOK_SECRET` ‚Äî –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `YOOKASSA_ENABLED` ‚Äî –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ÆKassa (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)

### 3. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–ª–∞—Ç–µ–∂–µ–π

**–°–æ–∑–¥–∞—Ç—å `src/core/payments/index.ts`** ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞:
```typescript
export interface PaymentProviderInterface {
  createPaymentLink(userId: number, packageInfo: PaymentPackage): Promise<string>;
  getPaymentPackage(): PaymentPackage;
  isEnabled(): boolean;
}

// –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
export { createPaymentLink as createStarsPaymentLink, ... } from './stars';
export { createPaymentLink as createYooKassaPaymentLink, ... } from './yookassa';

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
export async function createPaymentLink(
  userId: number, 
  packageInfo: PaymentPackage, 
  provider: PaymentProvider
): Promise<string> {
  if (provider === 'stars') {
    return createStarsPaymentLink(userId, packageInfo);
  } else if (provider === 'yookassa') {
    return createYooKassaPaymentLink(userId, packageInfo);
  }
  throw new Error(`Unknown payment provider: ${provider}`);
}
```

**–û–±–Ω–æ–≤–∏—Ç—å `src/core/payments/stars.ts`**:
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `createPaymentButton` –≤ `createStarsPaymentButton` –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç –∞–ª–∏–∞—Å–∞

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º

**–î–æ–±–∞–≤–∏—Ç—å –≤ `src/web/server.ts`**:
- –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /webhooks/yookassa` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –ÆKassa
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- –ü–∞—Ä—Å–∏–Ω–≥ payload –æ—Ç –ÆKassa
- –í—ã–∑–æ–≤ `handleYooKassaWebhook()` –∏–∑ –º–æ–¥—É–ª—è `yookassa.ts`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö webhook –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ IP –∞–¥—Ä–µ—Å–æ–≤ –ÆKassa (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook —á–µ—Ä–µ–∑ `YOOKASSA_WEBHOOK_SECRET`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ÆKassa –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏ –∫–æ–º–∞–Ω–¥

**–û–±–Ω–æ–≤–∏—Ç—å `src/bot/commands/credits.ts`**:
- –ü—Ä–∏ –ø–æ–∫–∞–∑–µ –±–∞–ª–∞–Ω—Å–∞ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üí∞ –ö—É–ø–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã"
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã (–µ—Å–ª–∏ –æ–±–∞ –¥–æ—Å—Ç—É–ø–Ω—ã):
  ```
  üí≥ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:
  [‚≠ê Telegram Stars] [üí≥ –ÆKassa]
  [‚ùå –û—Ç–º–µ–Ω–∞]
  ```

**–û–±–Ω–æ–≤–∏—Ç—å `src/bot/commands/buy.ts`** (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π):
- –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä
- –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω ‚Äî —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑–∞—Ç—å –æ–ø–ª–∞—Ç—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `createPaymentLink()`

**–û–±–Ω–æ–≤–∏—Ç—å `src/core/payments/stars.ts`**:
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `createPaymentButton` –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ÆKassa
- –ï—Å–ª–∏ –ÆKassa –≤–∫–ª—é—á–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ÆKassa

**–í `src/core/payments/yookassa.ts`**:

**–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ÆKassa API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `payment_id` –æ—Ç –ÆKassa –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
- –í–µ—Ä–Ω—É—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- Payload –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `user_id` –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (`payment.succeeded`, `payment.canceled`)
- –î–ª—è `payment.succeeded`:
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –ø–æ `payment_id`
  - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É –ø–ª–∞—Ç–µ–∂–∞
  - –ò–∑–≤–ª–µ—á—å `user_id` –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞
  - –í—ã–∑–≤–∞—Ç—å `addCredits()` –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤
  - –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `completed`
  - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
- –î–ª—è `payment.canceled`:
  - –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `failed`
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∞**:
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ –≤ –ÆKassa –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ `metadata`:
  ```json
  {
    "user_id": 123456789,
    "credits": 10,
    "package_type": "translation"
  }
  ```

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `003_add_yookassa_support.sql`**:
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–ª–∞—Ç–µ–∂–∞
ALTER TABLE payment_transactions 
ADD COLUMN IF NOT EXISTS payment_provider VARCHAR(20) DEFAULT 'stars';

-- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å telegram_payment_charge_id –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π payment_external_id
-- –ù–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
ALTER TABLE payment_transactions 
ADD COLUMN IF NOT EXISTS payment_external_id VARCHAR(255);

-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è ID –ø–ª–∞—Ç–µ–∂–∞ –ÆKassa
ALTER TABLE payment_transactions 
ADD COLUMN IF NOT EXISTS yookassa_payment_id VARCHAR(255);

-- –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏
UPDATE payment_transactions 
SET payment_external_id = telegram_payment_charge_id 
WHERE payment_external_id IS NULL AND telegram_payment_charge_id IS NOT NULL;

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_payment_provider ON payment_transactions(payment_provider);
CREATE INDEX IF NOT EXISTS idx_payment_external_id ON payment_transactions(payment_external_id);
CREATE UNIQUE INDEX IF NOT EXISTS idx_yookassa_payment_id ON payment_transactions(yookassa_payment_id) 
WHERE yookassa_payment_id IS NOT NULL;

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
COMMENT ON COLUMN payment_transactions.payment_provider IS 'Payment provider: stars or yookassa';
COMMENT ON COLUMN payment_transactions.payment_external_id IS 'Universal external payment ID (charge_id for Stars, payment_id for YooKassa)';
COMMENT ON COLUMN payment_transactions.yookassa_payment_id IS 'YooKassa payment ID';
```

### 8. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤

**–û–±–Ω–æ–≤–∏—Ç—å `src/core/payments/credits.ts`**:
- –§—É–Ω–∫—Ü–∏—è `addCredits()` —É–∂–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞ –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `paymentProvider?: PaymentProvider` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±–Ω–æ–≤–∏—Ç—å `credit_usage_log` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–û–±–Ω–æ–≤–∏—Ç—å `src/core/payments/stars.ts`**:
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `addCredits()` –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `paymentProvider: 'stars'`

**–í `src/core/payments/yookassa.ts`**:
- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `addCredits()` –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `paymentProvider: 'yookassa'`

### 9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- –í—Å–µ –æ—à–∏–±–∫–∏ API –ÆKassa –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –û—à–∏–±–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü—Ä–∏ –æ—à–∏–±–∫–µ webhook ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ —É–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Fallback**:
- –ï—Å–ª–∏ –ÆKassa –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –≤–∫–ª—é—á–µ–Ω ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å Stars (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- –ï—Å–ª–∏ –æ–±–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

### 10. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –ÆKassa: < 500ms (API –≤—ã–∑–æ–≤)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook: < 100ms (–≤–∞–ª–∏–¥–∞—Ü–∏—è + –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling PostgreSQL (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- Prepared statements –¥–ª—è –≤—Å–µ—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (in-memory, TTL 5 –º–∏–Ω—É—Ç)

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook'–æ–≤ (–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –ÆKassa)
- Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- Retry logic –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ API –ÆKassa (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

### 11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –≤—Å–µ—Ö webhook'–æ–≤ –æ—Ç –ÆKassa
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ÆKassa –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection (—Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ `payment_id` –ø–µ—Ä–µ–¥ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º)
- –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 4 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `payment_id` –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–∞–∫–µ—Ç—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `user_id` –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –æ—Ç –ÆKassa API

### 12. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –ÆKassa (—Å–æ–∑–¥–∞–Ω–∏–µ, webhook, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ)
- –û—à–∏–±–∫–∏ API —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ú–µ—Ç—Ä–∏–∫–∏: –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞, –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏**:
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º (Stars vs –ÆKassa)
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –ø–æ–∫—É–ø–∫–∏
- –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã
- –í—ã—Ä—É—á–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º

### 13. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è `yookassa.ts` (–º–æ–∫–∏ API –ÆKassa)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- –¢–µ—Å—Ç—ã edge cases (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π, –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ webhook'–∏)
- –¢–µ—Å—Ç—ã fallback –Ω–∞ Stars –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ÆKassa

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥:
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `credits.ts` –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã –∏–∑ `types.ts` (—Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î (—Ä–∞—Å—à–∏—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–µ–π)
- –ù–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π
- –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- –ù–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Telegram Stars
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Stars –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
- –ï—Å–ª–∏ `YOOKASSA_ENABLED=false`, —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ Stars
- Graceful degradation: –ø—Ä–∏ –æ—à–∏–±–∫–µ –ÆKassa ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å Stars (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –ë–î
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ –ë–î

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `@yookassa/sdk` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
2. –°–æ–∑–¥–∞—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ÆKassa –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–ª–∞—Ç–µ–∂–µ–π
3. –û–±–Ω–æ–≤–∏—Ç—å `types.ts` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `yookassa.ts` —Å –±–∞–∑–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
5. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `config.ts`
6. –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ `payments/index.ts`
7. –î–æ–±–∞–≤–∏—Ç—å webhook endpoint –≤ `server.ts`
8. –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
9. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã `/credits` –∏ `/buy` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
10. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏
11. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –ÆKassa –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è < 500ms
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è < 100ms
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –º–µ–∂–¥—É Stars –∏ –ÆKassa
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ Edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—à–∏–±–∫–∏ API)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- –û–±–Ω–æ–≤–∏—Ç—å `TELEGRAM_STARS_SETUP.md` ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `PAYMENTS_SETUP.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±–æ–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ÆKassa –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- –û–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook URL –≤ –ÆKassa

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: Stars –≤–∫–ª—é—á–µ–Ω, –ÆKassa –≤—ã–∫–ª—é—á–µ–Ω
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –æ–±–∞ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω
- –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –ÆKassa –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (`YOOKASSA_SHOP_ID`, `YOOKASSA_SECRET_KEY`)

### UI/UX:
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–∞ –¥–æ—Å—Ç—É–ø–Ω—ã
- –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω ‚Äî –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä, —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –æ–ø–ª–∞—Ç–µ
- –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ –ø–æ–∫—É–ø–∫–µ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏

